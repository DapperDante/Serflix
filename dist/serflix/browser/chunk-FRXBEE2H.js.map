{
  "version": 3,
  "sources": ["src/app/movies/service/favorite-movies.service.ts"],
  "sourcesContent": ["import { inject, Injectable } from '@angular/core';\r\nimport { environment } from 'src/environments/environment.development';\r\nimport { HttpClient, HttpErrorResponse, HttpEvent, HttpHandlerFn, HttpRequest } from '@angular/common/http';\r\nimport { catchError, map, Observable, tap, throwError } from 'rxjs';\r\nimport { MovieInfo, MoviesInfo } from '../api/movie-info.api';\r\nimport { Service } from 'src/app/interface/service.interface';\r\nimport { ErrorHandlingService } from 'src/app/error/error-handling.service';\r\n\r\nconst PATH = environment.ApiDbMovies;\r\n\r\n@Injectable({\r\n\tprovidedIn: 'platform'\r\n})\r\nexport class FavoriteMoviesService implements Service{\r\n\tprivate readonly _http = inject(HttpClient);\r\n\tprivate readonly _error = inject(ErrorHandlingService);\r\n\tconstructor(){\r\n\t\tconsole.log(`Service ${this.constructor.name} is ready`);\r\n\t}\r\n\tgetMoviesProfile(): Observable<MoviesInfo> {\r\n\t\treturn this._http.get<MoviesInfo>(`${PATH}/get`)\r\n\t\t.pipe(\r\n\t\t\tcatchError(this.ErrorHandler),\r\n\t\t\ttap({error: (error)=>this.ShowError(error)})\r\n\t\t);\r\n\t}\r\n\taddMovie(idMovie: number): Observable<{ msg: string; id: number }> {\r\n\t\tconst movie = {idMovie};\r\n\t\treturn this._http.post<{ msg: string; id: number }>(`${PATH}/add`,movie).pipe(\r\n\t\t\tcatchError(this.ErrorHandler),\r\n\t\t\ttap({error: (error)=>this.ShowError(error)})\r\n\t\t)\r\n\t}\r\n\tgetMovieProfile(idMovie: number | string): Observable<{id:number, results: MovieInfo}> {\r\n\t\treturn this._http.get<{id:number, results: MovieInfo}>(`${PATH}/get/${idMovie}`)\r\n\t\t.pipe(\r\n\t\t\tcatchError(this.ErrorHandler),\r\n\t\t\ttap({error: (error)=>this.ShowError(error)})\r\n\t\t);\r\n\t}\r\n\tdeteleMovie(idDoc: number | string): Observable<void> {\r\n\t\treturn this._http.delete<void>(`${PATH}/delete/${idDoc}`)\r\n\t\t.pipe(\r\n\t\t\tcatchError(this.ErrorHandler),\r\n\t\t\ttap({error: (error)=>this.ShowError(error)})\r\n\t\t);\r\n\t}\r\n\tShowError(error: Error): void {\r\n\t\tthis._error.ShowError(error.message);\r\n\t}\r\n\tErrorHandler(error: HttpErrorResponse){\r\n\t\tlet message = '';\r\n\t\tswitch (error.status) {\r\n\t\t\tcase 404:\r\n\t\t\t\tmessage = 'Movie not found';\r\n\t\t\t\tbreak;\r\n\t\t\tcase 500:\r\n\t\t\t\tmessage = 'Server error';\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tmessage = 'Server disconnected';\r\n\t\t}\r\n\t\treturn throwError(()=> new Error(message));\r\n\t}\r\n}\r\nexport function FavoriteMoviesInterceptor(\r\n\treq: HttpRequest<unknown>,\r\n\tnext: HttpHandlerFn\r\n): Observable<HttpEvent<unknown>> {\r\n\tif (!req.url.includes(PATH)) return next(req);\r\n\tconst BASE_IMG = environment.ApiTmdbImage;\r\n\tconst newReq = req.clone();\r\n\treturn next(newReq).pipe(\r\n\t\tmap((data: any) => {\r\n\t\t\tconst { body } = data;\r\n\t\t\tif (body) {\r\n\t\t\t\tif ('results' in body && Array.isArray(body.results)) {\r\n\t\t\t\t\tbody.results = body.results\r\n\t\t\t\t\t\t.filter((item: any) => item.poster_path)\r\n\t\t\t\t\t\t.map((item: any) => {\r\n\t\t\t\t\t\t\titem.poster_path = `${BASE_IMG}${item.poster_path}`;\r\n\t\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn data;\r\n\t\t})\r\n\t);\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;AAQA,IAAM,OAAO,YAAY;AAKnB,IAAO,wBAAP,MAAO,uBAAqB;EAGjC,cAAA;AAFiB,SAAA,QAAQ,OAAO,UAAU;AACzB,SAAA,SAAS,OAAO,oBAAoB;AAEpD,YAAQ,IAAI,WAAW,KAAK,YAAY,IAAI,WAAW;EACxD;EACA,mBAAgB;AACf,WAAO,KAAK,MAAM,IAAgB,GAAG,IAAI,MAAM,EAC9C,KACA,WAAW,KAAK,YAAY,GAC5B,IAAI,EAAC,OAAO,CAAC,UAAQ,KAAK,UAAU,KAAK,EAAC,CAAC,CAAC;EAE9C;EACA,SAAS,SAAe;AACvB,UAAM,QAAQ,EAAC,QAAO;AACtB,WAAO,KAAK,MAAM,KAAkC,GAAG,IAAI,QAAO,KAAK,EAAE,KACxE,WAAW,KAAK,YAAY,GAC5B,IAAI,EAAC,OAAO,CAAC,UAAQ,KAAK,UAAU,KAAK,EAAC,CAAC,CAAC;EAE9C;EACA,gBAAgB,SAAwB;AACvC,WAAO,KAAK,MAAM,IAAqC,GAAG,IAAI,QAAQ,OAAO,EAAE,EAC9E,KACA,WAAW,KAAK,YAAY,GAC5B,IAAI,EAAC,OAAO,CAAC,UAAQ,KAAK,UAAU,KAAK,EAAC,CAAC,CAAC;EAE9C;EACA,YAAY,OAAsB;AACjC,WAAO,KAAK,MAAM,OAAa,GAAG,IAAI,WAAW,KAAK,EAAE,EACvD,KACA,WAAW,KAAK,YAAY,GAC5B,IAAI,EAAC,OAAO,CAAC,UAAQ,KAAK,UAAU,KAAK,EAAC,CAAC,CAAC;EAE9C;EACA,UAAU,OAAY;AACrB,SAAK,OAAO,UAAU,MAAM,OAAO;EACpC;EACA,aAAa,OAAwB;AACpC,QAAI,UAAU;AACd,YAAQ,MAAM,QAAQ;MACrB,KAAK;AACJ,kBAAU;AACV;MACD,KAAK;AACJ,kBAAU;AACV;MACD;AACC,kBAAU;IACZ;AACA,WAAO,WAAW,MAAK,IAAI,MAAM,OAAO,CAAC;EAC1C;;;uCAlDY,wBAAqB;IAAA;EAAA;;4EAArB,wBAAqB,SAArB,uBAAqB,WAAA,YAFrB,WAAU,CAAA;EAAA;;AAsDjB,SAAU,0BACf,KACA,MAAmB;AAEnB,MAAI,CAAC,IAAI,IAAI,SAAS,IAAI;AAAG,WAAO,KAAK,GAAG;AAC5C,QAAM,WAAW,YAAY;AAC7B,QAAM,SAAS,IAAI,MAAK;AACxB,SAAO,KAAK,MAAM,EAAE,KACnB,IAAI,CAAC,SAAa;AACjB,UAAM,EAAE,KAAI,IAAK;AACjB,QAAI,MAAM;AACT,UAAI,aAAa,QAAQ,MAAM,QAAQ,KAAK,OAAO,GAAG;AACrD,aAAK,UAAU,KAAK,QAClB,OAAO,CAAC,SAAc,KAAK,WAAW,EACtC,IAAI,CAAC,SAAa;AAClB,eAAK,cAAc,GAAG,QAAQ,GAAG,KAAK,WAAW;AACjD,iBAAO;QACR,CAAC;MACH;IACD;AACA,WAAO;EACR,CAAC,CAAC;AAEJ;",
  "names": []
}
