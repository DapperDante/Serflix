{
  "version": 3,
  "sources": ["src/app/movies/service/item-movies.service.ts"],
  "sourcesContent": ["import { HttpClient, HttpErrorResponse, HttpEvent, HttpHandlerFn, HttpRequest } from '@angular/common/http';\r\nimport { inject, Injectable } from '@angular/core';\r\nimport { catchError, map, Observable, tap, throwError } from 'rxjs';\r\nimport { Movies } from '../api/movies.api';\r\nimport { environment } from 'src/environments/environment.development';\r\nimport { MovieInfo, VideosResult } from '../api/movie-info.api';\r\nimport { Service } from 'src/app/interface/service.interface';\r\nimport { ErrorHandlingService } from 'src/app/error/error-handling.service';\r\n\r\nconst PATH: string = `${environment.ApiTmdb}/movie`;\r\nconst PATH_DISCOVER: string = `${environment.ApiTmdb}/discover/movie`;\r\n\r\n@Injectable({\r\n\tprovidedIn: 'platform'\r\n})\r\nexport class ItemMoviesService implements Service {\r\n\tprivate readonly _http = inject(HttpClient);\r\n\tprivate readonly _error = inject(ErrorHandlingService);\r\n\tconstructor() {\r\n\t\tconsole.log(`Service ${this.constructor.name} is ready`);\r\n\t}\r\n\tgetMoviesNowPlaying(page: number | string = 1): Observable<Movies> {\r\n\t\treturn this._http.get<Movies>(`${PATH}/now_playing?language=en-US&page=${page}`)\r\n\t\t.pipe(\r\n\t\t\tcatchError(this.ErrorHandler),\r\n\t\t\ttap({error: (error)=>this.ShowError(error)})\r\n\t\t);\r\n\t}\r\n\tgetMoviesPopular(page: number | string = 1): Observable<Movies> {\r\n\t\treturn this._http.get<Movies>(`${PATH}/popular?language=en-US&page=${page}`)\r\n\t\t.pipe(\r\n\t\t\tcatchError(this.ErrorHandler),\r\n\t\t\ttap({error: (error)=>this.ShowError(error)})\r\n\t\t);\r\n\t}\r\n\tgetMoviesTopReated(page: number | string = 1): Observable<Movies> {\r\n\t\treturn this._http.get<Movies>(`${PATH}/top_rated?language=en-US&page=${page}`)\r\n\t\t.pipe(\r\n\t\t\tcatchError(this.ErrorHandler),\r\n\t\t\ttap({error: (error)=>this.ShowError(error)})\r\n\t\t);\r\n\t}\r\n\tgetMoviesUpcoming(page: number | string = 1): Observable<Movies> {\r\n\t\treturn this._http.get<Movies>(`${PATH}/upcoming?language=en-US&page=${page}`)\r\n\t\t.pipe(\r\n\t\t\tcatchError(this.ErrorHandler),\r\n\t\t\ttap({error: (error)=>this.ShowError(error)})\r\n\t\t);\r\n\t}\r\n\tgetMovieById(id: string | number): Observable<MovieInfo> {\r\n\t\treturn this._http\r\n\t\t\t.get<MovieInfo>(\r\n\t\t\t\t`${PATH}/${id}?append_to_response=videos%2Cimages%2Ccredits%2Csimilar%2Crecommendations&language=en-US`\r\n\t\t\t)\r\n\t\t\t.pipe(\r\n\t\t\t\tmap((data) => {\r\n\t\t\t\t\tif(data.videos)\r\n\t\t\t\t\t\tdata.videos.results = [data.videos.results.find((video: VideosResult) => (video.type = 'Trailer'))!];\r\n\t\t\t\t\treturn data;\r\n\t\t\t\t}),\r\n\t\t\t\tcatchError(this.ErrorHandler),\r\n\t\t\t\ttap({error: (error)=>this.ShowError(error)})\r\n\t\t\t);\r\n\t}\r\n\tgetMoviesByGenre(idGenre: string | number, page: number | string = 1): Observable<Movies> {\r\n\t\treturn this._http.get<Movies>(`${PATH_DISCOVER}?with_genres=${idGenre}&page=${page}`)\r\n\t\t.pipe(\r\n\t\t\tcatchError(this.ErrorHandler),\r\n\t\t\ttap({error: (error)=>this.ShowError(error)})\r\n\t\t);\r\n\t}\r\n\tShowError(error: Error): void {\r\n\t\tthis._error.ShowError(error.message);\r\n\t}\r\n\tErrorHandler(error: HttpErrorResponse): Observable<never> {\r\n\t\tlet message = '';\r\n\t\tswitch (error.status) {\r\n\t\t\tdefault:\r\n\t\t\t\tmessage = 'Server disconnected';\r\n\t\t\t\tbreak;\r\n\t\t};\r\n\t\treturn throwError(() => new Error(message));\r\n\t}\r\n}\r\nexport function ItemMoviesInterceptor(req: HttpRequest<unknown>, next: HttpHandlerFn): Observable<HttpEvent<unknown>> {\r\n\tif (!(req.url.includes(PATH) || req.url.includes(PATH_DISCOVER))) return next(req);\r\n\tconst BASE_IMG = environment.ApiTmdbImage;\r\n\tconst newReq = req.clone();\r\n\treturn next(newReq).pipe(\r\n\t\tmap((data: any) => {\r\n\t\t\tconst { body } = data;\r\n\t\t\tif (body) {\r\n\t\t\t\tif ('results' in body && Array.isArray(body.results)) {\r\n\t\t\t\t\tbody.results = body.results\r\n\t\t\t\t\t\t.filter((item: any) => item.poster_path)\r\n\t\t\t\t\t\t.map((item: any) => {\r\n\t\t\t\t\t\t\titem.poster_path = `${BASE_IMG}${item.poster_path}`;\r\n\t\t\t\t\t\t\titem.backdrop_path = `${BASE_IMG}${item.backdrop_path}`;\r\n\t\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tbody.poster_path = `${BASE_IMG}${body.poster_path}`;\r\n\t\t\t\t\tbody.backdrop_path = `${BASE_IMG}${body.backdrop_path}`;\r\n\t\t\t\t\tif ('similar' in body && Array.isArray(body.similar.results)) {\r\n\t\t\t\t\t\tbody.similar.results = body.similar.results\r\n\t\t\t\t\t\t\t.filter((item: any) => item.poster_path)\r\n\t\t\t\t\t\t\t.map((item: any) => {\r\n\t\t\t\t\t\t\t\titem.poster_path = `${BASE_IMG}${item.poster_path}`\r\n\t\t\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ('recommendations' in body && Array.isArray(body.recommendations.results)) {\r\n\t\t\t\t\t\tbody.recommendations.results = body.recommendations.results\r\n\t\t\t\t\t\t\t.filter((item: any) => item.poster_path)\r\n\t\t\t\t\t\t\t.map((item: any) => {\r\n\t\t\t\t\t\t\t\titem.poster_path = `${BASE_IMG}${item.poster_path}`\r\n\t\t\t\t\t\t\t\treturn item;\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn data;\r\n\t\t})\r\n\t);\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;AASA,IAAM,OAAe,GAAG,YAAY,OAAO;AAC3C,IAAM,gBAAwB,GAAG,YAAY,OAAO;AAK9C,IAAO,oBAAP,MAAO,mBAAiB;EAG7B,cAAA;AAFiB,SAAA,QAAQ,OAAO,UAAU;AACzB,SAAA,SAAS,OAAO,oBAAoB;AAEpD,YAAQ,IAAI,WAAW,KAAK,YAAY,IAAI,WAAW;EACxD;EACA,oBAAoB,OAAwB,GAAC;AAC5C,WAAO,KAAK,MAAM,IAAY,GAAG,IAAI,oCAAoC,IAAI,EAAE,EAC9E,KACA,WAAW,KAAK,YAAY,GAC5B,IAAI,EAAC,OAAO,CAAC,UAAQ,KAAK,UAAU,KAAK,EAAC,CAAC,CAAC;EAE9C;EACA,iBAAiB,OAAwB,GAAC;AACzC,WAAO,KAAK,MAAM,IAAY,GAAG,IAAI,gCAAgC,IAAI,EAAE,EAC1E,KACA,WAAW,KAAK,YAAY,GAC5B,IAAI,EAAC,OAAO,CAAC,UAAQ,KAAK,UAAU,KAAK,EAAC,CAAC,CAAC;EAE9C;EACA,mBAAmB,OAAwB,GAAC;AAC3C,WAAO,KAAK,MAAM,IAAY,GAAG,IAAI,kCAAkC,IAAI,EAAE,EAC5E,KACA,WAAW,KAAK,YAAY,GAC5B,IAAI,EAAC,OAAO,CAAC,UAAQ,KAAK,UAAU,KAAK,EAAC,CAAC,CAAC;EAE9C;EACA,kBAAkB,OAAwB,GAAC;AAC1C,WAAO,KAAK,MAAM,IAAY,GAAG,IAAI,iCAAiC,IAAI,EAAE,EAC3E,KACA,WAAW,KAAK,YAAY,GAC5B,IAAI,EAAC,OAAO,CAAC,UAAQ,KAAK,UAAU,KAAK,EAAC,CAAC,CAAC;EAE9C;EACA,aAAa,IAAmB;AAC/B,WAAO,KAAK,MACV,IACA,GAAG,IAAI,IAAI,EAAE,0FAA0F,EAEvG,KACA,IAAI,CAAC,SAAQ;AACZ,UAAG,KAAK;AACP,aAAK,OAAO,UAAU,CAAC,KAAK,OAAO,QAAQ,KAAK,CAAC,UAAyB,MAAM,OAAO,SAAU,CAAE;AACpG,aAAO;IACR,CAAC,GACD,WAAW,KAAK,YAAY,GAC5B,IAAI,EAAC,OAAO,CAAC,UAAQ,KAAK,UAAU,KAAK,EAAC,CAAC,CAAC;EAE/C;EACA,iBAAiB,SAA0B,OAAwB,GAAC;AACnE,WAAO,KAAK,MAAM,IAAY,GAAG,aAAa,gBAAgB,OAAO,SAAS,IAAI,EAAE,EACnF,KACA,WAAW,KAAK,YAAY,GAC5B,IAAI,EAAC,OAAO,CAAC,UAAQ,KAAK,UAAU,KAAK,EAAC,CAAC,CAAC;EAE9C;EACA,UAAU,OAAY;AACrB,SAAK,OAAO,UAAU,MAAM,OAAO;EACpC;EACA,aAAa,OAAwB;AACpC,QAAI,UAAU;AACd,YAAQ,MAAM,QAAQ;MACrB;AACC,kBAAU;AACV;IACF;AAAC;AACD,WAAO,WAAW,MAAM,IAAI,MAAM,OAAO,CAAC;EAC3C;;;uCAnEY,oBAAiB;IAAA;EAAA;;4EAAjB,oBAAiB,SAAjB,mBAAiB,WAAA,YAFjB,WAAU,CAAA;EAAA;;AAuEjB,SAAU,sBAAsB,KAA2B,MAAmB;AACnF,MAAI,EAAE,IAAI,IAAI,SAAS,IAAI,KAAK,IAAI,IAAI,SAAS,aAAa;AAAI,WAAO,KAAK,GAAG;AACjF,QAAM,WAAW,YAAY;AAC7B,QAAM,SAAS,IAAI,MAAK;AACxB,SAAO,KAAK,MAAM,EAAE,KACnB,IAAI,CAAC,SAAa;AACjB,UAAM,EAAE,KAAI,IAAK;AACjB,QAAI,MAAM;AACT,UAAI,aAAa,QAAQ,MAAM,QAAQ,KAAK,OAAO,GAAG;AACrD,aAAK,UAAU,KAAK,QAClB,OAAO,CAAC,SAAc,KAAK,WAAW,EACtC,IAAI,CAAC,SAAa;AAClB,eAAK,cAAc,GAAG,QAAQ,GAAG,KAAK,WAAW;AACjD,eAAK,gBAAgB,GAAG,QAAQ,GAAG,KAAK,aAAa;AACrD,iBAAO;QACR,CAAC;MACH,OAAO;AACN,aAAK,cAAc,GAAG,QAAQ,GAAG,KAAK,WAAW;AACjD,aAAK,gBAAgB,GAAG,QAAQ,GAAG,KAAK,aAAa;AACrD,YAAI,aAAa,QAAQ,MAAM,QAAQ,KAAK,QAAQ,OAAO,GAAG;AAC7D,eAAK,QAAQ,UAAU,KAAK,QAAQ,QAClC,OAAO,CAAC,SAAc,KAAK,WAAW,EACtC,IAAI,CAAC,SAAa;AAClB,iBAAK,cAAc,GAAG,QAAQ,GAAG,KAAK,WAAW;AACjD,mBAAO;UACR,CAAC;QACH;AACA,YAAI,qBAAqB,QAAQ,MAAM,QAAQ,KAAK,gBAAgB,OAAO,GAAG;AAC7E,eAAK,gBAAgB,UAAU,KAAK,gBAAgB,QAClD,OAAO,CAAC,SAAc,KAAK,WAAW,EACtC,IAAI,CAAC,SAAa;AAClB,iBAAK,cAAc,GAAG,QAAQ,GAAG,KAAK,WAAW;AACjD,mBAAO;UACR,CAAC;QACH;MACD;IACD;AACA,WAAO;EACR,CAAC,CAAC;AAEJ;",
  "names": []
}
